[supervisord]
logfile=/dev/fd/1
logfile_maxbytes=0
loglevel=info
pidfile=/tmp/supervisord.pid
nodaemon=true
user=www-data
minfds=1024
minprocs=200

[program:crond]
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
redirect_stderr=true
command=php /usr/local/bin/run-with-secrets.php crond -f
user=www-data
autostart=true
autorestart=true

[program:php]
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
redirect_stderr=true
command=php /usr/local/bin/run-with-secrets.php docker-php-entrypoint php-fpm
user=www-data
autostart=true
autorestart=true

[program:php-fpm-prometheus-exporter]
stdout_logfile=/dev/stderr
stdout_logfile_maxbytes=0
redirect_stderr=true
environment=START_SCRIPT_CHECK_VARIABLE="ENABLE_PROMETHEUS_EXPORTER_RUNNER",START_SCRIPT_EXPECTED_VALUE="1"
command=/usr/local/bin/start-if-env-variable-is-set.sh
    /usr/bin/php-fpm-exporter server
    --phpfpm.scrape-uri=tcp://127.0.0.1:9000/orchestration/php-fpm-status
    --phpfpm.fix-process-count=true
    --web.listen-address=:9090
user=www-data
autostart=true
autorestart=true

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock ; use a unix:// URL  for a unix socket

[include]
files = /etc/supervisor.d/*.ini

[unix_http_server]
file=/tmp/supervisor.sock   ; the path to the socket file
